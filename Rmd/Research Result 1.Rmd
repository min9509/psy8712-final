---
title: "Research Result 1: Shinyapp"
author: "Minjeong Seo"
date: "`r Sys.Date()`"
output: 
    html_document:
    df_print: paged
knit: (function(inputFile, encoding) {rmarkdown::render(inputFile, encoding = encoding, output_dir = "../out") })
---

### Script Settings and Resources
This chunk is to suppress all output from a chunk but does not display a copy of the executed code.
```{r setup, include=FALSE}
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
library(tidyverse)
library(e1071)
library(GGally)
```

### Data Import and Cleaning
This chunk is to import the original data.
```{r import date}
# Import the original data.
Wave2_original_tbl <- read_tsv("../data/HCCP_2ndWave_Work_2nd.txt")
# Display tables
print(Wave2_original_tbl)
```
This chunk is to create a data frame with the variables and their codes
```{r code table}
# Create the table to explain variables and code
variable_table <- data.frame(
  Variables = c("Job satisfaction (DV)", "Clan culture (IV)", "Gender", "Marital Status", "Permanent Employment"),
  Code = c("W21Q26A, W21Q26B, W21Q26C", "W21Q25D, W21Q25E, W21Q25F", "W21DQ01", "W21DQ03", "W21Q28")
)

# Display table
print(variable_table)
```

This chunk is to clean the original data.
```{r cleaning date}
# Making cleaning data
Wave2_tbl <- Wave2_original_tbl %>%
  select(W21Q26A, W21Q26B, W21Q26C, W21Q25D, W21Q25E, W21Q25F, W21DQ01, W21DQ03, W21Q28) %>%
  rowwise() %>%
  mutate(job_satis = mean(c(W21Q26A, W21Q26B, W21Q26C))) %>%
  mutate(clan_culture = mean(c(W21Q25D, W21Q25E, W21Q25F))) %>%
  mutate(gender = factor(W21DQ01, levels = c("1", "2"), labels = c("Male", "Female"))) %>%
  mutate(marital = factor(W21DQ03, levels = c("1", "2", "3"), labels = c("Single", "Married", "Divorced/Widowed")))  %>%
  mutate(permanent = factor(W21Q28, levels = c("1", "2"), labels = c("Permanent", "Temporary"))) 
# Display tables
print(Wave2_tbl)
```

### Analysis
## (1) Descriptive Statistics
This chunk is to conduct the descriptive statistics.
```{r descriptive statistics}
# Get Numerical variables 
Wave2_tbl_N <- Wave2_tbl %>%
  select(job_satis, clan_culture) %>%
  summary()
Wave2_tbl_N
# Create a data frame with the variables and their statistics
Wave2_tbl_N2 <- data.frame(
  Variables = c("Job satisfaction (DV)", "Clan culture (IV)"),
  Mean = c(3.447, 3.350),
  Median = c(3.333, 3.333),
  Min = c(1.000, 1.000),
  Max = c(5.000, 5.000)
)

# Print the table
print(Wave2_tbl_N2)

# Count the number of variables
gender_female <- sum(Wave2_tbl$gender == "Female") 
gender_male <- sum(Wave2_tbl$gender == "Male")
marital_single <- sum(Wave2_tbl$marital == "Single")
marital_married <- sum(Wave2_tbl$marital == "Married")
marital_div_wid <- sum(Wave2_tbl$marital == "Divorced/Widowed")
permanent_p <- sum(Wave2_tbl$permanent == "Permanent")
permanent_t <- sum(Wave2_tbl$permanent == "Temporary")

# Create a data frame with the variables and their statistics
Wave2_tbl_C <- data.frame(
  Variables = c("Gender", "", "Marital Status", "", "", "Permanent Employment", ""),
  Category = c("Male", "Female", "Single", "Married", "Divorced/Widowed", "Permanent", "Temporary"),
  N = c(gender_male, gender_female, marital_single, marital_married, marital_div_wid, permanent_p, permanent_t),
  Total = c("", sum(gender_male, gender_female), "", "", sum(marital_single, marital_married, marital_div_wid), "", sum(permanent_p, permanent_t))
)

# Display numbers
print(Wave2_tbl_C)
```

## (2) Correlation and Regression
This chunk is to conduct the correlation.
```{r analysis}
# Conduct correlation
wave2_corr <- cor.test(Wave2_tbl$job_satis, Wave2_tbl$clan_culture)

# Display correlation
print(wave2_corr)

# Conduct regression
lm.a = lm(job_satis ~ 1 + clan_culture, data = Wave2_tbl)

# Display regression
print(lm.a)
```

### Visualization
## (1) Histogram
This chunk is to create histograms for Job satisfaction and Clan culture.
```{r histogram}
# Making the histogram forjob satisfaction
job_satis_his <- ggplot(Wave2_tbl, aes(x = job_satis)) +
  geom_histogram(binwidth = 0.5, fill = "skyblue", color = "black") +
  labs(title = "The Histogram of Job Satisfaction",
       x = "Job Satisfaction",
       y = "Frequency")

# Making the histogram for clan culture
clan_culture_his <- ggplot(Wave2_tbl, aes(x = clan_culture)) +
  geom_histogram(binwidth = 0.5, fill = "lightgreen", color = "black") +
  labs(title = "The Histogram of Clan Culture",
       x = "Clan Culture",
       y = "Frequency")

# Display the histograms
print(job_satis_his)
print(clan_culture_his)

# Save the charts
job_satis_his %>% ggsave(filename = "../figs/Fig1.png")
clan_culture_his %>% ggsave(filename = "../figs/Fig2.png")

# Calculate skewness and kurtosis for job_satis and clan_culture
skew_job_satis <- skewness(Wave2_tbl$job_satis)
kurt_job_satis <- kurtosis(Wave2_tbl$job_satis)
skews_clan_culture <- skewness(Wave2_tbl$clan_culture)
kurt_clan_culture <- kurtosis(Wave2_tbl$clan_culture)

# Create a data frame with the variables and their statistics
Wave2_tbl_N3 <- data.frame(
  Variables = c("Job satisfaction (DV)", "Clan culture (IV)"),
  Skewness = c(skew_job_satis, skews_clan_culture),
  Kurtosis = c(kurt_job_satis, kurt_clan_culture))
  
# Display skewness and kurtosis
print(Wave2_tbl_N3)
```

## (2) Scatter Plot
This chunk is to make the scatter plot with the smooth line. 
```{r scatter}
# Make the scatter plot with lm line
Wave2_tbl %>%
  ggplot(aes(x = clan_culture, y = job_satis)) +
  geom_point() +
  geom_smooth(method = "lm", color = "#c62f4b")+
  labs(title = "The Scatter Plot of Clan Culture & Job Satisfaction",
       x = "Average of Clan Culture", 
       y = "Average of Job Satisfaction")
```

# **Data Export**
This chunk is to export data. 
```{r export}
# export data for shiny app
Wave2_tbl %>% 
  saveRDS(file = "../shiny_final/final_data.rds")
```